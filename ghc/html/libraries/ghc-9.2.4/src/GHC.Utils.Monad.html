<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | Utilities related to Monad and Applicative classes</span><span>
</span><span id="line-2"></span><span class="hs-comment">--   Mostly for backwards compatibility.</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Utils.Monad</span><span>
</span><span id="line-5"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Applicative"><span class="hs-identifier">Applicative</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator">(&lt;$&gt;)</span></a></span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Control-Monad-Fix.html#MonadFix"><span class="hs-identifier">MonadFix</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Control-Monad-IO-Class.html#MonadIO"><span class="hs-identifier">MonadIO</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#zipWith3M"><span class="hs-identifier">zipWith3M</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#zipWith3M_"><span class="hs-identifier">zipWith3M_</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#zipWith4M"><span class="hs-identifier">zipWith4M</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#zipWithAndUnzipM"><span class="hs-identifier">zipWithAndUnzipM</span></a></span><span>
</span><span id="line-12"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Control-Monad.html#mapAndUnzipM"><span class="hs-identifier">mapAndUnzipM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#mapAndUnzip3M"><span class="hs-identifier">mapAndUnzip3M</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#mapAndUnzip4M"><span class="hs-identifier">mapAndUnzip4M</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#mapAndUnzip5M"><span class="hs-identifier">mapAndUnzip5M</span></a></span><span>
</span><span id="line-13"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#mapAccumLM"><span class="hs-identifier">mapAccumLM</span></a></span><span>
</span><span id="line-14"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#liftFstM"><span class="hs-identifier">liftFstM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#liftSndM"><span class="hs-identifier">liftSndM</span></a></span><span>
</span><span id="line-15"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#mapSndM"><span class="hs-identifier">mapSndM</span></a></span><span>
</span><span id="line-16"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#concatMapM"><span class="hs-identifier">concatMapM</span></a></span><span>
</span><span id="line-17"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#mapMaybeM"><span class="hs-identifier">mapMaybeM</span></a></span><span>
</span><span id="line-18"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#fmapMaybeM"><span class="hs-identifier">fmapMaybeM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#fmapEitherM"><span class="hs-identifier">fmapEitherM</span></a></span><span>
</span><span id="line-19"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#anyM"><span class="hs-identifier">anyM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#allM"><span class="hs-identifier">allM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#orM"><span class="hs-identifier">orM</span></a></span><span>
</span><span id="line-20"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-Foldable.html#foldlM"><span class="hs-identifier">foldlM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#foldlM_"><span class="hs-identifier">foldlM_</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-Foldable.html#foldrM"><span class="hs-identifier">foldrM</span></a></span><span>
</span><span id="line-21"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#maybeMapM"><span class="hs-identifier">maybeMapM</span></a></span><span>
</span><span id="line-22"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#whenM"><span class="hs-identifier">whenM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#unlessM"><span class="hs-identifier">unlessM</span></a></span><span>
</span><span id="line-23"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#filterOutM"><span class="hs-identifier">filterOutM</span></a></span><span>
</span><span id="line-24"></span><span>        </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- Imports</span><span>
</span><span id="line-28"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Control-Applicative.html#"><span class="hs-identifier">Control.Applicative</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Control-Monad.html#"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Control-Monad-Fix.html#"><span class="hs-identifier">Control.Monad.Fix</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Control-Monad-IO-Class.html#"><span class="hs-identifier">Control.Monad.IO.Class</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-Foldable.html#"><span class="hs-identifier">Data.Foldable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/Data-Foldable.html#sequenceA_"><span class="hs-identifier">sequenceA_</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-Foldable.html#foldlM"><span class="hs-identifier">foldlM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-Foldable.html#foldrM"><span class="hs-identifier">foldrM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-List.html#"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/Data-OldList.html#unzip4"><span class="hs-identifier">unzip4</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-OldList.html#unzip5"><span class="hs-identifier">unzip5</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-OldList.html#zipWith4"><span class="hs-identifier">zipWith4</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-40"></span><span class="hs-comment">-- Common functions</span><span>
</span><span id="line-41"></span><span class="hs-comment">--  These are used throughout the compiler</span><span>
</span><span id="line-42"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-comment">{-

Note [Inline @zipWithNM@ functions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The inline principle for 'zipWith3M', 'zipWith4M' and 'zipWith3M_' is the same
as for 'zipWithM' and 'zipWithM_' in &quot;Control.Monad&quot;, see
Note [Fusion for zipN/zipWithN] in GHC/List.hs for more details.

The 'zipWithM'/'zipWithM_' functions are inlined so that the `zipWith` and
`sequenceA` functions with which they are defined have an opportunity to fuse.

Furthermore, 'zipWith3M'/'zipWith4M' and 'zipWith3M_' have been explicitly
rewritten in a non-recursive way similarly to 'zipWithM'/'zipWithM_', and for
more than just uniformity: after [D5241](https://phabricator.haskell.org/D5241)
for issue #14037, all @zipN@/@zipWithN@ functions fuse, meaning
'zipWith3M'/'zipWIth4M' and 'zipWith3M_'@ now behave like 'zipWithM' and
'zipWithM_', respectively, with regards to fusion.

As such, since there are not any differences between 2-ary 'zipWithM'/
'zipWithM_' and their n-ary counterparts below aside from the number of
arguments, the `INLINE` pragma should be replicated in the @zipWithNM@
functions below as well.

-}</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span id="local-6989586621680962667"><span id="local-6989586621680962668"><span id="local-6989586621680962669"><span id="local-6989586621680962670"><span id="local-6989586621680962671"><span class="annot"><a href="GHC.Utils.Monad.html#zipWith3M"><span class="hs-identifier hs-type">zipWith3M</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962671"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962670"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962669"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962668"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962671"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962667"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962670"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962669"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962668"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962671"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962667"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">]</span></span></span></span></span></span><span>
</span><span id="line-71"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#zipWith3M"><span class="hs-pragma hs-type">zipWith3M</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- Inline so that fusion with 'zipWith3' and 'sequenceA' has a chance to fire.</span><span>
</span><span id="line-73"></span><span class="hs-comment">-- See Note [Inline @zipWithNM@ functions] above.</span><span>
</span><span id="line-74"></span><span id="zipWith3M"><span class="annot"><span class="annottext">zipWith3M :: forall (m :: * -&gt; *) a b c d.
Monad m =&gt;
(a -&gt; b -&gt; c -&gt; m d) -&gt; [a] -&gt; [b] -&gt; [c] -&gt; m [d]
</span><a href="GHC.Utils.Monad.html#zipWith3M"><span class="hs-identifier hs-var hs-var">zipWith3M</span></a></span></span><span> </span><span id="local-6989586621680962401"><span class="annot"><span class="annottext">a -&gt; b -&gt; c -&gt; m d
</span><a href="#local-6989586621680962401"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680962400"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680962400"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621680962399"><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621680962399"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span id="local-6989586621680962398"><span class="annot"><span class="annottext">[c]
</span><a href="#local-6989586621680962398"><span class="hs-identifier hs-var">zs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a.
(Traversable t, Applicative f) =&gt;
t (f a) -&gt; f (t a)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#sequenceA"><span class="hs-identifier hs-var">sequenceA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b c d. (a -&gt; b -&gt; c -&gt; d) -&gt; [a] -&gt; [b] -&gt; [c] -&gt; [d]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#zipWith3"><span class="hs-identifier hs-var">zipWith3</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; b -&gt; c -&gt; m d
</span><a href="#local-6989586621680962401"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680962400"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621680962399"><span class="hs-identifier hs-var">ys</span></a></span><span> </span><span class="annot"><span class="annottext">[c]
</span><a href="#local-6989586621680962398"><span class="hs-identifier hs-var">zs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span id="local-6989586621680962649"><span id="local-6989586621680962650"><span id="local-6989586621680962651"><span id="local-6989586621680962652"><span id="local-6989586621680962653"><span class="annot"><a href="GHC.Utils.Monad.html#zipWith3M_"><span class="hs-identifier hs-type">zipWith3M_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962653"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962652"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962651"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962650"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962653"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962649"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962652"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962651"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962650"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962653"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-77"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#zipWith3M_"><span class="hs-pragma hs-type">zipWith3M_</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-78"></span><span class="hs-comment">-- Inline so that fusion with 'zipWith4' and 'sequenceA' has a chance to fire.</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- See  Note [Inline @zipWithNM@ functions] above.</span><span>
</span><span id="line-80"></span><span id="zipWith3M_"><span class="annot"><span class="annottext">zipWith3M_ :: forall (m :: * -&gt; *) a b c d.
Monad m =&gt;
(a -&gt; b -&gt; c -&gt; m d) -&gt; [a] -&gt; [b] -&gt; [c] -&gt; m ()
</span><a href="GHC.Utils.Monad.html#zipWith3M_"><span class="hs-identifier hs-var hs-var">zipWith3M_</span></a></span></span><span> </span><span id="local-6989586621680962390"><span class="annot"><span class="annottext">a -&gt; b -&gt; c -&gt; m d
</span><a href="#local-6989586621680962390"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680962389"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680962389"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621680962388"><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621680962388"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span id="local-6989586621680962387"><span class="annot"><span class="annottext">[c]
</span><a href="#local-6989586621680962387"><span class="hs-identifier hs-var">zs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a.
(Foldable t, Applicative f) =&gt;
t (f a) -&gt; f ()
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#sequenceA_"><span class="hs-identifier hs-var">sequenceA_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b c d. (a -&gt; b -&gt; c -&gt; d) -&gt; [a] -&gt; [b] -&gt; [c] -&gt; [d]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#zipWith3"><span class="hs-identifier hs-var">zipWith3</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; b -&gt; c -&gt; m d
</span><a href="#local-6989586621680962390"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680962389"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621680962388"><span class="hs-identifier hs-var">ys</span></a></span><span> </span><span class="annot"><span class="annottext">[c]
</span><a href="#local-6989586621680962387"><span class="hs-identifier hs-var">zs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span id="local-6989586621680962635"><span id="local-6989586621680962636"><span id="local-6989586621680962637"><span id="local-6989586621680962638"><span id="local-6989586621680962639"><span id="local-6989586621680962640"><span class="annot"><a href="GHC.Utils.Monad.html#zipWith4M"><span class="hs-identifier hs-type">zipWith4M</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962640"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962639"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962638"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962637"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962636"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962640"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962635"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962639"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962638"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962637"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962636"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962640"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962635"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">]</span></span></span></span></span></span></span><span>
</span><span id="line-84"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#zipWith4M"><span class="hs-pragma hs-type">zipWith4M</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- Inline so that fusion with 'zipWith5' and 'sequenceA' has a chance to fire.</span><span>
</span><span id="line-86"></span><span class="hs-comment">-- See  Note [Inline @zipWithNM@ functions] above.</span><span>
</span><span id="line-87"></span><span id="zipWith4M"><span class="annot"><span class="annottext">zipWith4M :: forall (m :: * -&gt; *) a b c d e.
Monad m =&gt;
(a -&gt; b -&gt; c -&gt; d -&gt; m e) -&gt; [a] -&gt; [b] -&gt; [c] -&gt; [d] -&gt; m [e]
</span><a href="GHC.Utils.Monad.html#zipWith4M"><span class="hs-identifier hs-var hs-var">zipWith4M</span></a></span></span><span> </span><span id="local-6989586621680962382"><span class="annot"><span class="annottext">a -&gt; b -&gt; c -&gt; d -&gt; m e
</span><a href="#local-6989586621680962382"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680962381"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680962381"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621680962380"><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621680962380"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span id="local-6989586621680962379"><span class="annot"><span class="annottext">[c]
</span><a href="#local-6989586621680962379"><span class="hs-identifier hs-var">ws</span></a></span></span><span> </span><span id="local-6989586621680962378"><span class="annot"><span class="annottext">[d]
</span><a href="#local-6989586621680962378"><span class="hs-identifier hs-var">zs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a.
(Traversable t, Applicative f) =&gt;
t (f a) -&gt; f (t a)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#sequenceA"><span class="hs-identifier hs-var">sequenceA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b c d e.
(a -&gt; b -&gt; c -&gt; d -&gt; e) -&gt; [a] -&gt; [b] -&gt; [c] -&gt; [d] -&gt; [e]
</span><a href="../../base-4.16.3.0/src/Data-OldList.html#zipWith4"><span class="hs-identifier hs-var">zipWith4</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; b -&gt; c -&gt; d -&gt; m e
</span><a href="#local-6989586621680962382"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680962381"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621680962380"><span class="hs-identifier hs-var">ys</span></a></span><span> </span><span class="annot"><span class="annottext">[c]
</span><a href="#local-6989586621680962379"><span class="hs-identifier hs-var">ws</span></a></span><span> </span><span class="annot"><span class="annottext">[d]
</span><a href="#local-6989586621680962378"><span class="hs-identifier hs-var">zs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span id="local-6989586621680962619"><span id="local-6989586621680962620"><span id="local-6989586621680962621"><span id="local-6989586621680962622"><span id="local-6989586621680962623"><span class="annot"><a href="GHC.Utils.Monad.html#zipWithAndUnzipM"><span class="hs-identifier hs-type">zipWithAndUnzipM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962623"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-90"></span><span>                 </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962622"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962621"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962623"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962620"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680962619"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962622"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962621"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962623"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962620"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962619"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-91"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#zipWithAndUnzipM"><span class="hs-pragma hs-type">zipWithAndUnzipM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>  </span><span class="hs-comment">-- this allows specialization to a given monad</span><span>
</span><span id="line-92"></span><span id="zipWithAndUnzipM"><span class="annot"><span class="annottext">zipWithAndUnzipM :: forall (m :: * -&gt; *) a b c d.
Monad m =&gt;
(a -&gt; b -&gt; m (c, d)) -&gt; [a] -&gt; [b] -&gt; m ([c], [d])
</span><a href="GHC.Utils.Monad.html#zipWithAndUnzipM"><span class="hs-identifier hs-var hs-var">zipWithAndUnzipM</span></a></span></span><span> </span><span id="local-6989586621680962371"><span class="annot"><span class="annottext">a -&gt; b -&gt; m (c, d)
</span><a href="#local-6989586621680962371"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680962370"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680962370"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621680962369"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680962369"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680962368"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680962368"><span class="hs-identifier hs-var">y</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621680962367"><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621680962367"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680962366"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680962366"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680962365"><span class="annot"><span class="annottext">d
</span><a href="#local-6989586621680962365"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">a -&gt; b -&gt; m (c, d)
</span><a href="#local-6989586621680962371"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680962370"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680962368"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-94"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680962364"><span class="annot"><span class="annottext">[c]
</span><a href="#local-6989586621680962364"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680962363"><span class="annot"><span class="annottext">[d]
</span><a href="#local-6989586621680962363"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b c d.
Monad m =&gt;
(a -&gt; b -&gt; m (c, d)) -&gt; [a] -&gt; [b] -&gt; m ([c], [d])
</span><a href="GHC.Utils.Monad.html#zipWithAndUnzipM"><span class="hs-identifier hs-var">zipWithAndUnzipM</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; b -&gt; m (c, d)
</span><a href="#local-6989586621680962371"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680962369"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621680962367"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-95"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680962366"><span class="hs-identifier hs-var">c</span></a></span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[c]
</span><a href="#local-6989586621680962364"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">d
</span><a href="#local-6989586621680962365"><span class="hs-identifier hs-var">d</span></a></span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[d]
</span><a href="#local-6989586621680962363"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-96"></span><span class="annot"><a href="GHC.Utils.Monad.html#zipWithAndUnzipM"><span class="hs-identifier hs-var">zipWithAndUnzipM</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; b -&gt; m (c, d)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[b]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-comment">{-

Note [Inline @mapAndUnzipNM@ functions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The inline principle is the same as 'mapAndUnzipM' in &quot;Control.Monad&quot;.
The 'mapAndUnzipM' function is inlined so that the `unzip` and `traverse`
functions with which it is defined have an opportunity to fuse, see
Note [Inline @unzipN@ functions] in Data/OldList.hs for more details.

Furthermore, the @mapAndUnzipNM@ functions have been explicitly rewritten in a
non-recursive way similarly to 'mapAndUnzipM', and for more than just
uniformity: after [D5249](https://phabricator.haskell.org/D5249) for Trac
ticket #14037, all @unzipN@ functions fuse, meaning 'mapAndUnzip3M',
'mapAndUnzip4M' and 'mapAndUnzip5M' now behave like 'mapAndUnzipM' with regards
to fusion.

As such, since there are not any differences between 2-ary 'mapAndUnzipM' and
its n-ary counterparts below aside from the number of arguments, the `INLINE`
pragma should be replicated in the @mapAndUnzipNM@ functions below as well.

-}</span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span class="hs-comment">-- | mapAndUnzipM for triples</span><span>
</span><span id="line-122"></span><span id="local-6989586621680962607"><span id="local-6989586621680962608"><span id="local-6989586621680962609"><span id="local-6989586621680962610"><span id="local-6989586621680962611"><span class="annot"><a href="GHC.Utils.Monad.html#mapAndUnzip3M"><span class="hs-identifier hs-type">mapAndUnzip3M</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962611"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962610"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962611"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962609"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621680962608"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621680962607"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962610"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962611"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962609"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962608"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962607"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-123"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#mapAndUnzip3M"><span class="hs-pragma hs-type">mapAndUnzip3M</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-124"></span><span class="hs-comment">-- Inline so that fusion with 'unzip3' and 'traverse' has a chance to fire.</span><span>
</span><span id="line-125"></span><span class="hs-comment">-- See Note [Inline @mapAndUnzipNM@ functions] above.</span><span>
</span><span id="line-126"></span><span id="mapAndUnzip3M"><span class="annot"><span class="annottext">mapAndUnzip3M :: forall (m :: * -&gt; *) a b c d.
Monad m =&gt;
(a -&gt; m (b, c, d)) -&gt; [a] -&gt; m ([b], [c], [d])
</span><a href="GHC.Utils.Monad.html#mapAndUnzip3M"><span class="hs-identifier hs-var hs-var">mapAndUnzip3M</span></a></span></span><span> </span><span id="local-6989586621680962355"><span class="annot"><span class="annottext">a -&gt; m (b, c, d)
</span><a href="#local-6989586621680962355"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680962354"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680962354"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">forall a b c. [(a, b, c)] -&gt; ([a], [b], [c])
</span><a href="../../base-4.16.3.0/src/GHC-List.html#unzip3"><span class="hs-identifier hs-var">unzip3</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; m (b, c, d)
</span><a href="#local-6989586621680962355"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680962354"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span id="local-6989586621680962586"><span id="local-6989586621680962587"><span id="local-6989586621680962588"><span id="local-6989586621680962589"><span id="local-6989586621680962590"><span id="local-6989586621680962591"><span class="annot"><a href="GHC.Utils.Monad.html#mapAndUnzip4M"><span class="hs-identifier hs-type">mapAndUnzip4M</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962591"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962590"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962591"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962589"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621680962588"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621680962587"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621680962586"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962590"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962591"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962589"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962588"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962587"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962586"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-129"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#mapAndUnzip4M"><span class="hs-pragma hs-type">mapAndUnzip4M</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-130"></span><span class="hs-comment">-- Inline so that fusion with 'unzip4' and 'traverse' has a chance to fire.</span><span>
</span><span id="line-131"></span><span class="hs-comment">-- See Note [Inline @mapAndUnzipNM@ functions] above.</span><span>
</span><span id="line-132"></span><span id="mapAndUnzip4M"><span class="annot"><span class="annottext">mapAndUnzip4M :: forall (m :: * -&gt; *) a b c d e.
Monad m =&gt;
(a -&gt; m (b, c, d, e)) -&gt; [a] -&gt; m ([b], [c], [d], [e])
</span><a href="GHC.Utils.Monad.html#mapAndUnzip4M"><span class="hs-identifier hs-var hs-var">mapAndUnzip4M</span></a></span></span><span> </span><span id="local-6989586621680962345"><span class="annot"><span class="annottext">a -&gt; m (b, c, d, e)
</span><a href="#local-6989586621680962345"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680962344"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680962344"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">forall a b c d. [(a, b, c, d)] -&gt; ([a], [b], [c], [d])
</span><a href="../../base-4.16.3.0/src/Data-OldList.html#unzip4"><span class="hs-identifier hs-var">unzip4</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; m (b, c, d, e)
</span><a href="#local-6989586621680962345"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680962344"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span id="local-6989586621680962569"><span id="local-6989586621680962570"><span id="local-6989586621680962571"><span id="local-6989586621680962572"><span id="local-6989586621680962573"><span id="local-6989586621680962574"><span id="local-6989586621680962575"><span class="annot"><a href="GHC.Utils.Monad.html#mapAndUnzip5M"><span class="hs-identifier hs-type">mapAndUnzip5M</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962575"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962574"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962575"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962573"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621680962572"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621680962571"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621680962570"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621680962569"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962574"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962575"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962573"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962572"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962571"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962570"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962569"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span></span></span></span></span></span></span><span>
</span><span id="line-135"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#mapAndUnzip5M"><span class="hs-pragma hs-type">mapAndUnzip5M</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-136"></span><span class="hs-comment">-- Inline so that fusion with 'unzip5' and 'traverse' has a chance to fire.</span><span>
</span><span id="line-137"></span><span class="hs-comment">-- See Note [Inline @mapAndUnzipNM@ functions] above.</span><span>
</span><span id="line-138"></span><span id="mapAndUnzip5M"><span class="annot"><span class="annottext">mapAndUnzip5M :: forall (m :: * -&gt; *) a b c d e f.
Monad m =&gt;
(a -&gt; m (b, c, d, e, f)) -&gt; [a] -&gt; m ([b], [c], [d], [e], [f])
</span><a href="GHC.Utils.Monad.html#mapAndUnzip5M"><span class="hs-identifier hs-var hs-var">mapAndUnzip5M</span></a></span></span><span> </span><span id="local-6989586621680962337"><span class="annot"><span class="annottext">a -&gt; m (b, c, d, e, f)
</span><a href="#local-6989586621680962337"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680962336"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680962336"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">forall a b c d e. [(a, b, c, d, e)] -&gt; ([a], [b], [c], [d], [e])
</span><a href="../../base-4.16.3.0/src/Data-OldList.html#unzip5"><span class="hs-identifier hs-var">unzip5</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; m (b, c, d, e, f)
</span><a href="#local-6989586621680962337"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680962336"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="hs-comment">-- TODO: mapAccumLM is used in many places. Surely most of</span><span>
</span><span id="line-141"></span><span class="hs-comment">-- these don't actually want to be lazy. We should add a strict</span><span>
</span><span id="line-142"></span><span class="hs-comment">-- variant and use it where appropriate.</span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span class="hs-comment">-- | Monadic version of mapAccumL</span><span>
</span><span id="line-145"></span><span id="local-6989586621680962553"><span id="local-6989586621680962554"><span id="local-6989586621680962555"><span id="local-6989586621680962556"><span class="annot"><a href="GHC.Utils.Monad.html#mapAccumLM"><span class="hs-identifier hs-type">mapAccumLM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962556"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-146"></span><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962555"><span class="hs-identifier hs-type">acc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962554"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962556"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962555"><span class="hs-identifier hs-type">acc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680962553"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ combining function</span><span>
</span><span id="line-147"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962555"><span class="hs-identifier hs-type">acc</span></a></span><span>                      </span><span class="hs-comment">-- ^ initial state</span><span>
</span><span id="line-148"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962554"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">]</span><span>                      </span><span class="hs-comment">-- ^ inputs</span><span>
</span><span id="line-149"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962556"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962555"><span class="hs-identifier hs-type">acc</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962553"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span></span></span></span><span>             </span><span class="hs-comment">-- ^ final state, outputs</span><span>
</span><span id="line-150"></span><span id="mapAccumLM"><span class="annot"><span class="annottext">mapAccumLM :: forall (m :: * -&gt; *) acc x y.
Monad m =&gt;
(acc -&gt; x -&gt; m (acc, y)) -&gt; acc -&gt; [x] -&gt; m (acc, [y])
</span><a href="GHC.Utils.Monad.html#mapAccumLM"><span class="hs-identifier hs-var hs-var">mapAccumLM</span></a></span></span><span> </span><span id="local-6989586621680962330"><span class="annot"><span class="annottext">acc -&gt; x -&gt; m (acc, y)
</span><a href="#local-6989586621680962330"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680962329"><span class="annot"><span class="annottext">acc
</span><a href="#local-6989586621680962329"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621680962328"><span class="annot"><span class="annottext">[x]
</span><a href="#local-6989586621680962328"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-151"></span><span>  </span><span class="annot"><span class="annottext">acc -&gt; [x] -&gt; m (acc, [y])
</span><a href="#local-6989586621680962327"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">acc
</span><a href="#local-6989586621680962329"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">[x]
</span><a href="#local-6989586621680962328"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-153"></span><span>    </span><span id="local-6989586621680962327"><span class="annot"><span class="annottext">go :: acc -&gt; [x] -&gt; m (acc, [y])
</span><a href="#local-6989586621680962327"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680962326"><span class="annot"><span class="annottext">acc
</span><a href="#local-6989586621680962326"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680962325"><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621680962325"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621680962324"><span class="annot"><span class="annottext">[x]
</span><a href="#local-6989586621680962324"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-154"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680962323"><span class="annot"><span class="annottext">acc
</span><a href="#local-6989586621680962323"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680962322"><span class="annot"><span class="annottext">y
</span><a href="#local-6989586621680962322"><span class="hs-identifier hs-var">x'</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">acc -&gt; x -&gt; m (acc, y)
</span><a href="#local-6989586621680962330"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">acc
</span><a href="#local-6989586621680962326"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621680962325"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-155"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680962321"><span class="annot"><span class="annottext">acc
</span><a href="#local-6989586621680962321"><span class="hs-identifier hs-var">s2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680962320"><span class="annot"><span class="annottext">[y]
</span><a href="#local-6989586621680962320"><span class="hs-identifier hs-var">xs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">acc -&gt; [x] -&gt; m (acc, [y])
</span><a href="#local-6989586621680962327"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">acc
</span><a href="#local-6989586621680962323"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">[x]
</span><a href="#local-6989586621680962324"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-156"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">acc
</span><a href="#local-6989586621680962321"><span class="hs-identifier hs-var">s2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">y
</span><a href="#local-6989586621680962322"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[y]
</span><a href="#local-6989586621680962320"><span class="hs-identifier hs-var">xs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>    </span><span class="annot"><a href="#local-6989586621680962327"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621680962319"><span class="annot"><span class="annottext">acc
</span><a href="#local-6989586621680962319"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">acc
</span><a href="#local-6989586621680962319"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="hs-comment">-- | Monadic version of mapSnd</span><span>
</span><span id="line-160"></span><span id="local-6989586621680962545"><span id="local-6989586621680962546"><span id="local-6989586621680962547"><span id="local-6989586621680962548"><span class="annot"><a href="GHC.Utils.Monad.html#mapSndM"><span class="hs-identifier hs-type">mapSndM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962548"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962547"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962548"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962546"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962545"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621680962547"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962548"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962545"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621680962546"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span></span></span><span>
</span><span id="line-161"></span><span id="mapSndM"><span class="annot"><span class="annottext">mapSndM :: forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; [(a, b)] -&gt; m [(a, c)]
</span><a href="GHC.Utils.Monad.html#mapSndM"><span class="hs-identifier hs-var hs-var">mapSndM</span></a></span></span><span> </span><span id="local-6989586621680962313"><span class="annot"><span class="annottext">b -&gt; m c
</span><a href="#local-6989586621680962313"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680962312"><span class="annot"><span class="annottext">[(a, b)]
</span><a href="#local-6989586621680962312"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(a, b)] -&gt; m [(a, c)]
</span><a href="#local-6989586621680962311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, b)]
</span><a href="#local-6989586621680962312"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-163"></span><span>    </span><span id="local-6989586621680962311"><span class="annot"><span class="annottext">go :: [(a, b)] -&gt; m [(a, c)]
</span><a href="#local-6989586621680962311"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><a href="#local-6989586621680962311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680962310"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680962310"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680962309"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680962309"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621680962308"><span class="annot"><span class="annottext">[(a, b)]
</span><a href="#local-6989586621680962308"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621680962307"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680962307"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">b -&gt; m c
</span><a href="#local-6989586621680962313"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680962309"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">;</span><span> </span><span id="local-6989586621680962306"><span class="annot"><span class="annottext">[(a, c)]
</span><a href="#local-6989586621680962306"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(a, b)] -&gt; m [(a, c)]
</span><a href="#local-6989586621680962311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, b)]
</span><a href="#local-6989586621680962308"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680962310"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680962307"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[(a, c)]
</span><a href="#local-6989586621680962306"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span id="local-6989586621680962537"><span id="local-6989586621680962538"><span id="local-6989586621680962539"><span id="local-6989586621680962540"><span class="annot"><a href="GHC.Utils.Monad.html#liftFstM"><span class="hs-identifier hs-type">liftFstM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962540"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962539"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962538"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962540"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962539"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680962537"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962540"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962538"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680962537"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-167"></span><span id="liftFstM"><span class="annot"><span class="annottext">liftFstM :: forall (m :: * -&gt; *) a b r.
Monad m =&gt;
(a -&gt; b) -&gt; m (a, r) -&gt; m (b, r)
</span><a href="GHC.Utils.Monad.html#liftFstM"><span class="hs-identifier hs-var hs-var">liftFstM</span></a></span></span><span> </span><span id="local-6989586621680962302"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621680962302"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680962301"><span class="annot"><span class="annottext">m (a, r)
</span><a href="#local-6989586621680962301"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680962300"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680962300"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680962299"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680962299"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (a, r)
</span><a href="#local-6989586621680962301"><span class="hs-identifier hs-var">thing</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621680962302"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680962300"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680962299"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span id="local-6989586621680962529"><span id="local-6989586621680962530"><span id="local-6989586621680962531"><span id="local-6989586621680962532"><span class="annot"><a href="GHC.Utils.Monad.html#liftSndM"><span class="hs-identifier hs-type">liftSndM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962532"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962531"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962530"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962532"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962529"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680962531"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962532"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962529"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680962530"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-170"></span><span id="liftSndM"><span class="annot"><span class="annottext">liftSndM :: forall (m :: * -&gt; *) a b r.
Monad m =&gt;
(a -&gt; b) -&gt; m (r, a) -&gt; m (r, b)
</span><a href="GHC.Utils.Monad.html#liftSndM"><span class="hs-identifier hs-var hs-var">liftSndM</span></a></span></span><span> </span><span id="local-6989586621680962295"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621680962295"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680962294"><span class="annot"><span class="annottext">m (r, a)
</span><a href="#local-6989586621680962294"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680962293"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680962293"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680962292"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680962292"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (r, a)
</span><a href="#local-6989586621680962294"><span class="hs-identifier hs-var">thing</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680962293"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621680962295"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680962292"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span class="hs-comment">-- | Monadic version of concatMap</span><span>
</span><span id="line-173"></span><span id="local-6989586621680962522"><span id="local-6989586621680962523"><span id="local-6989586621680962524"><span class="annot"><a href="GHC.Utils.Monad.html#concatMapM"><span class="hs-identifier hs-type">concatMapM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962524"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962523"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962524"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962522"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962523"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962524"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962522"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-174"></span><span id="concatMapM"><span class="annot"><span class="annottext">concatMapM :: forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m [b]) -&gt; [a] -&gt; m [b]
</span><a href="GHC.Utils.Monad.html#concatMapM"><span class="hs-identifier hs-var hs-var">concatMapM</span></a></span></span><span> </span><span id="local-6989586621680962286"><span class="annot"><span class="annottext">a -&gt; m [b]
</span><a href="#local-6989586621680962286"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680962285"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680962285"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#liftM"><span class="hs-identifier hs-var">liftM</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; m [b]
</span><a href="#local-6989586621680962286"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680962285"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="hs-comment">-- | Applicative version of mapMaybe</span><span>
</span><span id="line-177"></span><span id="local-6989586621680962508"><span id="local-6989586621680962509"><span id="local-6989586621680962510"><span class="annot"><a href="GHC.Utils.Monad.html#mapMaybeM"><span class="hs-identifier hs-type">mapMaybeM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Applicative"><span class="hs-identifier hs-type">Applicative</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962510"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962509"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962510"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962508"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962509"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962510"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962508"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-178"></span><span id="mapMaybeM"><span class="annot"><span class="annottext">mapMaybeM :: forall (m :: * -&gt; *) a b.
Applicative m =&gt;
(a -&gt; m (Maybe b)) -&gt; [a] -&gt; m [b]
</span><a href="GHC.Utils.Monad.html#mapMaybeM"><span class="hs-identifier hs-var hs-var">mapMaybeM</span></a></span></span><span> </span><span id="local-6989586621680962277"><span class="annot"><span class="annottext">a -&gt; m (Maybe b)
</span><a href="#local-6989586621680962277"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; m [b] -&gt; m [b]
</span><a href="#local-6989586621680962275"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680962275"><span class="annot"><span class="annottext">g :: a -&gt; m [b] -&gt; m [b]
</span><a href="#local-6989586621680962275"><span class="hs-identifier hs-var hs-var">g</span></a></span></span><span> </span><span id="local-6989586621680962274"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680962274"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b c.
Applicative f =&gt;
(a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#liftA2"><span class="hs-identifier hs-var">liftA2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../base-4.16.3.0/src/Data-Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; m (Maybe b)
</span><a href="#local-6989586621680962277"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680962274"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="hs-comment">-- | Monadic version of fmap</span><span>
</span><span id="line-182"></span><span id="local-6989586621680962492"><span id="local-6989586621680962493"><span id="local-6989586621680962494"><span class="annot"><a href="GHC.Utils.Monad.html#fmapMaybeM"><span class="hs-identifier hs-type">fmapMaybeM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962494"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962493"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962494"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962492"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962493"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962494"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962492"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-183"></span><span id="fmapMaybeM"><span class="annot"><span class="annottext">fmapMaybeM :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; Maybe a -&gt; m (Maybe b)
</span><a href="GHC.Utils.Monad.html#fmapMaybeM"><span class="hs-identifier hs-var hs-var">fmapMaybeM</span></a></span></span><span> </span><span class="annot"><span class="annottext">a -&gt; m b
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-184"></span><span class="annot"><a href="GHC.Utils.Monad.html#fmapMaybeM"><span class="hs-identifier hs-var">fmapMaybeM</span></a></span><span> </span><span id="local-6989586621680962266"><span class="annot"><span class="annottext">a -&gt; m b
</span><a href="#local-6989586621680962266"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680962265"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680962265"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; m b
</span><a href="#local-6989586621680962266"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680962265"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span class="hs-comment">-- | Monadic version of fmap</span><span>
</span><span id="line-187"></span><span id="local-6989586621680962479"><span id="local-6989586621680962480"><span id="local-6989586621680962481"><span id="local-6989586621680962482"><span id="local-6989586621680962483"><span class="annot"><a href="GHC.Utils.Monad.html#fmapEitherM"><span class="hs-identifier hs-type">fmapEitherM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962483"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962482"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962483"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962481"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962480"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962483"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962479"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962482"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962480"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962483"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/Data-Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962481"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962479"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-188"></span><span id="fmapEitherM"><span class="annot"><span class="annottext">fmapEitherM :: forall (m :: * -&gt; *) a b c d.
Monad m =&gt;
(a -&gt; m b) -&gt; (c -&gt; m d) -&gt; Either a c -&gt; m (Either b d)
</span><a href="GHC.Utils.Monad.html#fmapEitherM"><span class="hs-identifier hs-var hs-var">fmapEitherM</span></a></span></span><span> </span><span id="local-6989586621680962258"><span class="annot"><span class="annottext">a -&gt; m b
</span><a href="#local-6989586621680962258"><span class="hs-identifier hs-var">fl</span></a></span></span><span> </span><span class="annot"><span class="annottext">c -&gt; m d
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/Data-Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span>  </span><span id="local-6989586621680962257"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680962257"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; m b
</span><a href="#local-6989586621680962258"><span class="hs-identifier hs-var">fl</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680962257"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><a href="../../base-4.16.3.0/src/Data-Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span class="annot"><a href="GHC.Utils.Monad.html#fmapEitherM"><span class="hs-identifier hs-var">fmapEitherM</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; m b
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680962256"><span class="annot"><span class="annottext">c -&gt; m d
</span><a href="#local-6989586621680962256"><span class="hs-identifier hs-var">fr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/Data-Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621680962255"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680962255"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">c -&gt; m d
</span><a href="#local-6989586621680962256"><span class="hs-identifier hs-var">fr</span></a></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680962255"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="../../base-4.16.3.0/src/Data-Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span class="hs-comment">-- | Monadic version of 'any', aborts the computation at the first @True@ value</span><span>
</span><span id="line-192"></span><span id="local-6989586621680962470"><span id="local-6989586621680962471"><span class="annot"><a href="GHC.Utils.Monad.html#anyM"><span class="hs-identifier hs-type">anyM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962471"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962470"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962471"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962470"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962471"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-193"></span><span id="anyM"><span class="annot"><span class="annottext">anyM :: forall (m :: * -&gt; *) a. Monad m =&gt; (a -&gt; m Bool) -&gt; [a] -&gt; m Bool
</span><a href="GHC.Utils.Monad.html#anyM"><span class="hs-identifier hs-var hs-var">anyM</span></a></span></span><span> </span><span id="local-6989586621680962250"><span class="annot"><span class="annottext">a -&gt; m Bool
</span><a href="#local-6989586621680962250"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680962249"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680962249"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; m Bool
</span><a href="#local-6989586621680962248"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680962249"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-195"></span><span>    </span><span id="local-6989586621680962248"><span class="annot"><span class="annottext">go :: [a] -&gt; m Bool
</span><a href="#local-6989586621680962248"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-196"></span><span>    </span><span class="annot"><a href="#local-6989586621680962248"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680962247"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680962247"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621680962246"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680962246"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621680962245"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680962245"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">a -&gt; m Bool
</span><a href="#local-6989586621680962250"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680962247"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-197"></span><span>                   </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680962245"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-198"></span><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; m Bool
</span><a href="#local-6989586621680962248"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680962246"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-comment">-- | Monad version of 'all', aborts the computation at the first @False@ value</span><span>
</span><span id="line-201"></span><span id="local-6989586621680962243"><span id="local-6989586621680962244"><span class="annot"><a href="GHC.Utils.Monad.html#allM"><span class="hs-identifier hs-type">allM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962244"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962243"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962244"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962243"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962244"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-202"></span><span id="allM"><span class="annot"><span class="annottext">allM :: forall (m :: * -&gt; *) a. Monad m =&gt; (a -&gt; m Bool) -&gt; [a] -&gt; m Bool
</span><a href="GHC.Utils.Monad.html#allM"><span class="hs-identifier hs-var hs-var">allM</span></a></span></span><span> </span><span id="local-6989586621680962238"><span class="annot"><span class="annottext">a -&gt; m Bool
</span><a href="#local-6989586621680962238"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680962237"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680962237"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; m Bool
</span><a href="#local-6989586621680962236"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680962237"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-204"></span><span>    </span><span id="local-6989586621680962236"><span class="annot"><span class="annottext">go :: [a] -&gt; m Bool
</span><a href="#local-6989586621680962236"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-205"></span><span>    </span><span class="annot"><a href="#local-6989586621680962236"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680962235"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680962235"><span class="hs-identifier hs-var">b</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621680962234"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680962234"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; m Bool
</span><a href="#local-6989586621680962238"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680962235"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680962233"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680962233"><span class="hs-identifier hs-var">bv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680962233"><span class="hs-identifier hs-var">bv</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; m Bool
</span><a href="#local-6989586621680962236"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680962234"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span class="hs-comment">-- | Monadic version of or</span><span>
</span><span id="line-208"></span><span id="local-6989586621680962465"><span class="annot"><a href="GHC.Utils.Monad.html#orM"><span class="hs-identifier hs-type">orM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962465"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962465"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962465"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962465"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-209"></span><span id="orM"><span class="annot"><span class="annottext">orM :: forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m Bool -&gt; m Bool
</span><a href="GHC.Utils.Monad.html#orM"><span class="hs-identifier hs-var hs-var">orM</span></a></span></span><span> </span><span id="local-6989586621680962229"><span class="annot"><span class="annottext">m Bool
</span><a href="#local-6989586621680962229"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span id="local-6989586621680962228"><span class="annot"><span class="annottext">m Bool
</span><a href="#local-6989586621680962228"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m Bool
</span><a href="#local-6989586621680962229"><span class="hs-identifier hs-var">m1</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680962227"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680962227"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680962227"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">m Bool
</span><a href="#local-6989586621680962228"><span class="hs-identifier hs-var">m2</span></a></span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span class="hs-comment">-- | Monadic version of foldl that discards its result</span><span>
</span><span id="line-212"></span><span id="local-6989586621680962460"><span id="local-6989586621680962461"><span id="local-6989586621680962462"><span id="local-6989586621680962463"><span class="annot"><a href="GHC.Utils.Monad.html#foldlM_"><span class="hs-identifier hs-type">foldlM_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962463"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-Foldable.html#Foldable"><span class="hs-identifier hs-type">Foldable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962462"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962461"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962460"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962463"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962461"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962461"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962462"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962460"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962463"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-213"></span><span id="foldlM_"><span class="annot"><span class="annottext">foldlM_ :: forall (m :: * -&gt; *) (t :: * -&gt; *) a b.
(Monad m, Foldable t) =&gt;
(a -&gt; b -&gt; m a) -&gt; a -&gt; t b -&gt; m ()
</span><a href="GHC.Utils.Monad.html#foldlM_"><span class="hs-identifier hs-var hs-var">foldlM_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m ()
</span><a href="../../base-4.16.3.0/src/Control-Monad.html#foldM_"><span class="hs-identifier hs-var">foldM_</span></a></span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span class="hs-comment">-- | Monadic version of fmap specialised for Maybe</span><span>
</span><span id="line-216"></span><span id="local-6989586621680962219"><span id="local-6989586621680962220"><span id="local-6989586621680962221"><span class="annot"><a href="GHC.Utils.Monad.html#maybeMapM"><span class="hs-identifier hs-type">maybeMapM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962221"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962220"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962221"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962219"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962220"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962221"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962219"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-217"></span><span id="maybeMapM"><span class="annot"><span class="annottext">maybeMapM :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; Maybe a -&gt; m (Maybe b)
</span><a href="GHC.Utils.Monad.html#maybeMapM"><span class="hs-identifier hs-var hs-var">maybeMapM</span></a></span></span><span> </span><span class="annot"><span class="annottext">a -&gt; m b
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-218"></span><span class="annot"><a href="GHC.Utils.Monad.html#maybeMapM"><span class="hs-identifier hs-var">maybeMapM</span></a></span><span> </span><span id="local-6989586621680962215"><span class="annot"><span class="annottext">a -&gt; m b
</span><a href="#local-6989586621680962215"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680962214"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680962214"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#liftM"><span class="hs-identifier hs-var">liftM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; m b
</span><a href="#local-6989586621680962215"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680962214"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="hs-comment">-- | Monadic version of @when@, taking the condition in the monad</span><span>
</span><span id="line-221"></span><span id="local-6989586621680962447"><span class="annot"><a href="GHC.Utils.Monad.html#whenM"><span class="hs-identifier hs-type">whenM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962447"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962447"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962447"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962447"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-222"></span><span id="whenM"><span class="annot"><span class="annottext">whenM :: forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="GHC.Utils.Monad.html#whenM"><span class="hs-identifier hs-var hs-var">whenM</span></a></span></span><span> </span><span id="local-6989586621680962209"><span class="annot"><span class="annottext">m Bool
</span><a href="#local-6989586621680962209"><span class="hs-identifier hs-var">mb</span></a></span></span><span> </span><span id="local-6989586621680962208"><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621680962208"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621680962207"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680962207"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Bool
</span><a href="#local-6989586621680962209"><span class="hs-identifier hs-var">mb</span></a></span><span>
</span><span id="line-223"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680962207"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621680962208"><span class="hs-identifier hs-var">thing</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="hs-comment">-- | Monadic version of @unless@, taking the condition in the monad</span><span>
</span><span id="line-226"></span><span id="local-6989586621680962205"><span class="annot"><a href="GHC.Utils.Monad.html#unlessM"><span class="hs-identifier hs-type">unlessM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962205"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962205"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962205"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962205"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-227"></span><span id="unlessM"><span class="annot"><span class="annottext">unlessM :: forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="GHC.Utils.Monad.html#unlessM"><span class="hs-identifier hs-var hs-var">unlessM</span></a></span></span><span> </span><span id="local-6989586621680962200"><span class="annot"><span class="annottext">m Bool
</span><a href="#local-6989586621680962200"><span class="hs-identifier hs-var">condM</span></a></span></span><span> </span><span id="local-6989586621680962199"><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621680962199"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621680962198"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680962198"><span class="hs-identifier hs-var">cond</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Bool
</span><a href="#local-6989586621680962200"><span class="hs-identifier hs-var">condM</span></a></span><span>
</span><span id="line-228"></span><span>                       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.3.0/src/Control-Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680962198"><span class="hs-identifier hs-var">cond</span></a></span><span> </span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621680962199"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span class="hs-comment">-- | Like 'filterM', only it reverses the sense of the test.</span><span>
</span><span id="line-231"></span><span id="local-6989586621680962442"><span id="local-6989586621680962443"><span class="annot"><a href="GHC.Utils.Monad.html#filterOutM"><span class="hs-identifier hs-type">filterOutM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Applicative"><span class="hs-identifier hs-type">Applicative</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680962443"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680962442"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962443"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962442"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680962443"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680962442"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-232"></span><span id="filterOutM"><span class="annot"><span class="annottext">filterOutM :: forall (m :: * -&gt; *) a.
Applicative m =&gt;
(a -&gt; m Bool) -&gt; [a] -&gt; m [a]
</span><a href="GHC.Utils.Monad.html#filterOutM"><span class="hs-identifier hs-var hs-var">filterOutM</span></a></span></span><span> </span><span id="local-6989586621680962192"><span class="annot"><span class="annottext">a -&gt; m Bool
</span><a href="#local-6989586621680962192"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-233"></span><span>  </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680962191"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680962191"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b c.
Applicative f =&gt;
(a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#liftA2"><span class="hs-identifier hs-var">liftA2</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680962190"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680962190"><span class="hs-identifier hs-var">flg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680962190"><span class="hs-identifier hs-var">flg</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680962191"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; m Bool
</span><a href="#local-6989586621680962192"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680962191"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span class="hs-comment">{- Note [The one-shot state monad trick]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Summary: many places in GHC use a state monad, and we really want those
functions to be eta-expanded (#18202).

The problem
~~~~~~~~~~~
Consider
    newtype M a = MkM (State -&gt; (State, a))

    instance Monad M where
       mf &gt;&gt;= k = MkM (\s -&gt; case mf  of MkM f  -&gt;
                             case f s of (s',r) -&gt;
                             case k r of MkM g  -&gt;
                             g s')

    fooM :: Int -&gt; M Int
    fooM x = g y &gt;&gt;= \r -&gt; h r
      where
        y = expensive x

Now suppose you say (repeat 20 (fooM 4)), where
  repeat :: Int -&gt; M Int -&gt; M Int
performs its argument n times.  You would expect (expensive 4) to be
evaluated only once, not 20 times.  So foo should have arity 1 (not 2);
it should look like this (modulo casts)

  fooM x = let y = expensive x in
           \s -&gt; case g y of ...

But creating and then repeating, a monadic computation is rare.  If you
/aren't/ re-using (M a) value, it's /much/ more efficient to make
foo have arity 2, thus:

  fooM x s = case g (expensive x) of ...

Why more efficient?  Because now foo takes its argument both at once,
rather than one at a time, creating a heap-allocated function closure. See
https://www.joachim-breitner.de/blog/763-Faster_Winter_5__Eta-Expanding_ReaderT
for a very good explanation of the issue which led to these optimisations
into GHC.

The trick
~~~~~~~~~
With state monads like M the general case is that we *aren't* reusing
(M a) values so it is much more efficient to avoid allocating a
function closure for them. So the state monad trick is a way to keep
the monadic syntax but to make GHC eta-expand functions like `fooM`.
To do that we use the &quot;oneShot&quot; magic function.

Here is the trick:
  * Define a &quot;smart constructor&quot;
       mkM :: (State -&gt; (State,a)) -&gt; M a
       mkM f = MkM (oneShot m)

  * Never call MkM directly, as a constructor.  Instead, always call mkM.

And that's it!  The magic 'oneShot' function does this transformation:
   oneShot (\s. e)  ==&gt;   \s{os}. e
which pins a one-shot flag {os} onto the binder 's'.  That tells GHC
that it can assume the lambda is called only once, and thus can freely
float computations in and out of the lambda.

To be concrete, let's see what happens to fooM:

 fooM = \x. g (expensive x) &gt;&gt;= \r -&gt; h r
      = \x. let mf = g (expensive x)
                k  = \r -&gt; h r
            in MkM (oneShot (\s -&gt; case mf  of MkM' f  -&gt;
                                   case f s of (s',r) -&gt;
                                   case k r of MkM' g  -&gt;
                                   g s'))
      -- The MkM' are just newtype casts nt_co
      = \x. let mf = g (expensive x)
                k  = \r -&gt; h r
            in (\s{os}. case (mf |&gt; nt_co) s of (s',r) -&gt;
                        (k r) |&gt; nt_co s')
               |&gt; sym nt_co

      -- Crucial step: float let-bindings into that \s{os}
      = \x. (\s{os}. case (g (expensive x) |&gt; nt_co) s of (s',r) -&gt;
                     h r |&gt; nt_co s')
            |&gt; sym nt_co

and voila! fooM has arity 2.

The trick is very similar to the built-in &quot;state hack&quot;
(see Note [The state-transformer hack] in &quot;GHC.Core.Opt.Arity&quot;) but is
applicable on a monad-by-monad basis under programmer control.

Using pattern synonyms
~~~~~~~~~~~~~~~~~~~~~~
Using a smart constructor is fine, but there is no way to check that we
have found *all* uses, especially if the uses escape a single module.
A neat (but more sophisticated) alternative is to use pattern synonyms:

   -- We rename the existing constructor.
   newtype M a = MkM' (State -&gt; (State, a))

   -- The pattern has the old constructor name.
   pattern MkM f &lt;- MkM' f
      where
        MkM f = MkM' (oneShot f)

Now we can simply grep to check that there are no uses of MkM'
/anywhere/, to guarantee that we have not missed any.  (Using the
smart constructor alone we still need the data constructor in
patterns.)  That's the advantage of the pattern-synonym approach, but
it is more elaborate.

The pattern synonym approach is due to Sebastian Graaf (#18238)

Do note that for monads for multiple arguments more than one oneShot
function might be required. For example in FCode we use:

    newtype FCode a = FCode' { doFCode :: CgInfoDownwards -&gt; CgState -&gt; (a, CgState) }

    pattern FCode :: (CgInfoDownwards -&gt; CgState -&gt; (a, CgState))
                  -&gt; FCode a
    pattern FCode m &lt;- FCode' m
      where
        FCode m = FCode' $ oneShot (\cgInfoDown -&gt; oneShot (\state -&gt;m cgInfoDown state))

Derived instances
~~~~~~~~~~~~~~~~~
One caveat of both approaches is that derived instances don't use the smart
constructor /or/ the pattern synonym. So they won't benefit from the automatic
insertion of &quot;oneShot&quot;.

   data M a = MkM' (State -&gt; (State,a))
            deriving (Functor) &lt;-- Functor implementation will use MkM'!

Conclusion: don't use 'derviving' in these cases.

Multi-shot actions (cf #18238)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Sometimes we really *do* want computations to be shared! Remember our
example (repeat 20 (fooM 4)). See Note [multiShotIO] in GHC.Types.Unique.Supply

We can force fooM to have arity 1 using multiShot:

    fooM :: Int -&gt; M Int
    fooM x = multiShotM (g y &gt;&gt;= \r -&gt; h r)
      where
        y = expensive x

    multiShotM :: M a -&gt; M a
    {-# INLINE multiShotM #-}
    multiShotM (MkM m) = MkM (\s -&gt; inline m s)
         -- Really uses the data constructor,
         -- not the smart constructor!

Now we can see how fooM optimises (ignoring casts)

   multiShotM (g y &gt;&gt;= \r -&gt; h r)
   ==&gt; {inline (&gt;&gt;=)}
       multiShotM (\s{os}. case g y s of ...)
   ==&gt; {inline multiShotM}
       let m = \s{os}. case g y s of ...
       in \s. inline m s
   ==&gt; {inline m}
       \s. (\s{os}. case g y s of ...) s
   ==&gt; \s. case g y s of ...

and voila! the one-shot flag has gone.  It's possible that y has been
replaced by (expensive x), but full laziness should pull it back out.
(This part seems less robust.)

The magic `inline` function does two things
* It prevents eta reduction.  If we wrote just
      multiShotIO (IO m) = IO (\s -&gt; m s)
  the lamda would eta-reduce to 'm' and all would be lost.

* It helps ensure that 'm' really does inline.

Note that 'inline' evaporates in phase 0.  See Note [inlineIdMagic]
in GHC.Core.Opt.ConstantFold.match_inline.

The INLINE pragma on multiShotM is very important, else the
'inline' call will evaporate when compiling the module that
defines 'multiShotM', before it is ever exported.
-}</span><span>
</span><span id="line-417"></span></pre></body></html>